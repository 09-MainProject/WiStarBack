#name: CI
#
#on:
#  push:
#
#
#jobs:
#  static-analysis:  # mypy, black, ruff ë“± ì •ì  ë¶„ì„
#    runs-on: ubuntu-22.04  # ê°€ìƒ ìš´ì˜ì²´ì œ í™˜ê²½ì—ì„œ ì‹¤í–‰ë¨. ì‹¤ì œ í”„ë¡£ë•ì…˜(ë°°í¬)í™˜ê²½ì—ì„œëŠ” ëª¨ë“  ë²„ì „ì„ ê³ ì •í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.
#    # ì˜ˆê¸°ì¹˜ ëª»í•˜ê²Œ ë²„ì „ì´ ì˜¬ë¼ê°€ì„œ ì¥ì• ê°€ ìƒê¸°ëŠ” ê²ƒì„ ë§‰ê¸° ìœ„í•´ ë²„ì „ì„ ê³ ì •
#    steps:
#      # ê°€ì¥ ìµœì‹  ë¸Œëœì¹˜ì™€ ì»¤ë°‹ì„ ê°€ì ¸ì˜´
#      - name: Check out the codes
#        uses: actions/checkout@v2
#
#      - name: Setup python environment
#        id: setup-python
#        uses: actions/setup-python@v2
#        with:
#          python-version: "3.13"
#
#      # ìºì‹œ ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ ë§¤ë²ˆ ì„¤ì¹˜í•˜ëŠ” ë‚­ë¹„ë¥¼ ì¤„ì„
#      # keyì™€ pathëŠ” í•„ìˆ˜
#      - name: Cache Poetry
#        id: cache-poetry
#        uses: actions/cache@v3
#        with:
#          key: poetry-2.1.2  # 	ìºì‹œ êµ¬ë¶„ìš© í‚¤ (ë²„ì „ë³„ë¡œ ë‹¤ë¥´ê²Œ êµ¬ë¶„)
#          path: ~/.local/   # poetryëŠ” ~/.localì— ì„¤ì¹˜ë˜ë¯€ë¡œ, ì´ ë””ë ‰í„°ë¦¬ë¥¼ í†µì§¸ë¡œ ìºì‹œí•  ê²ƒì…ë‹ˆë‹¤.
#
#
#      - name: Install Poetry
#        # ìºì‹œë¥¼ ëª» ì“°ëŠ” ê²½ìš°ì—ë§Œ ì„¤ì¹˜
#        if: steps.cache-poetry.outputs.cache-hit != 'true'
#        run: |
#          curl -sSL https://install.python-poetry.org | python3 - --version 2.1.2
#
#      # poetryë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì„¤ì •
#      - name: Register Poetry bin
#        run: echo "${HOME}/.poetry/bin" >> $GITHUB_PATH
#
#      - name: Cache dependencies
#        id: cache-venv
#        uses: actions/cache@v3
#        with:
#          # ì „ì²´ íŒŒì¼ì„ ë¹„êµí•˜ëŠ” ê²ƒë³´ë‹¤ hashê°’ë§Œ ë¹„êµí•˜ëŠ”ê²Œ ë¹ ë¦„.
#          key: python-${{ steps.setup-python.outputs.python-version }}-poetry-lock-${{ hashFiles('poetry.lock') }}-toml-${{ hashFiles('pyproject.toml') }}-poetry-2.1.2
#          path: /home/runner/.cache/pypoetry/virtualenvs/
#
#      - name: Install dependencies
#        # ìºì‹œë¥¼ ëª» ì“°ëŠ” ê²½ìš°ì—ë§Œ ì„¤ì¹˜
#        if: steps.cache-venv.outputs.cache-hit != 'true'
#        run: poetry install --no-root
#
#      # ì½”ë“œ í¬ë©”í„° (black)ìœ¼ë¡œ ì²´í¬ë§Œ í•¨.
#      - name: Run Black
#        run: poetry run black . --check
#
#      - name: Run Ruff
#        run: |
#          poetry run ruff check --select I
#          poetry run ruff check
#
#      - name: Run Mypy
#        run: poetry run mypy .
#
#  test:   # ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
#    runs-on: ubuntu-22.04
#
#    env:
#      MYSQL_HOST: 127.0.0.1
#      MYSQL_PORT: 3306
#      MYSQL_USER: root
#      MYSQL_PASSWORD: 1234
#      MYSQL_DATABASE: when2meet_vod
#
#    steps:
#      - name: Check out the codes
#        uses: actions/checkout@v2
#
#      - name: Setup python environment
#        id: setup-python
#        uses: actions/setup-python@v2
#        with:
#          python-version: "3.13"
#
#      # ìºì‹œ ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ ë§¤ë²ˆ ì„¤ì¹˜í•˜ëŠ” ë‚­ë¹„ë¥¼ ì¤„ì„
#      # keyì™€ pathëŠ” í•„ìˆ˜
#      - name: Cache Poetry
#        id: cache-poetry
#        uses: actions/cache@v3
#        with:
#          key: poetry-2.1.2  # 	ìºì‹œ êµ¬ë¶„ìš© í‚¤ (ë²„ì „ë³„ë¡œ ë‹¤ë¥´ê²Œ êµ¬ë¶„)
#          path: ~/.local/   # poetryëŠ” ~/.localì— ì„¤ì¹˜ë˜ë¯€ë¡œ, ì´ ë””ë ‰í„°ë¦¬ë¥¼ í†µì§¸ë¡œ ìºì‹œí•  ê²ƒì…ë‹ˆë‹¤.
#
#      - name: Install Poetry
#        # ìºì‹œë¥¼ ëª» ì“°ëŠ” ê²½ìš°ì—ë§Œ ì„¤ì¹˜
#        if: steps.cache-poetry.outputs.cache-hit != 'true'
#        run: |
#          curl -sSL https://install.python-poetry.org | python3 - --version 2.1.2
#
#      - name: Register Poetry bin
#        run: echo "${HOME}/.poetry/bin" >> $GITHUB_PATH
#
#      - name: Cache dependencies
#        id: cache-venv
#        uses: actions/cache@v3
#        with:
#          # ì „ì²´ íŒŒì¼ì„ ë¹„êµí•˜ëŠ” ê²ƒë³´ë‹¤ hashê°’ë§Œ ë¹„êµí•˜ëŠ”ê²Œ ë¹ ë¦„.
#          key: python-${{ steps.setup-python.outputs.python-version }}-poetry-lock-${{ hashFiles('poetry.lock') }}-toml-${{ hashFiles('pyproject.toml') }}-poetry-2.1.2
#          path: /home/runner/.cache/pypoetry/virtualenvs/
#
#      - name: Install dependencies
#        # ìºì‹œë¥¼ ëª» ì“°ëŠ” ê²½ìš°ì—ë§Œ ì„¤ì¹˜
#        if: steps.cache-venv.outputs.cache-hit != 'true'
#        run: poetry install --no-root
#
#      # /etc/localtime íŒŒì¼ì€ í˜„ì¬ ì‹œìŠ¤í…œì˜ ì‹œê°„ëŒ€ ì •ë³´ë¥¼ ë‹´ê³  ìˆëŠ” ì‹¬ë³¼ë¦­ ë§í¬. ì´ íŒŒì¼ì„ ì‚­ì œí•´ì„œ ì‹œê°„ëŒ€ ì„¤ì •ì„ ì´ˆê¸°í™”í•˜ë ¤ëŠ” ì˜ë„
#      # sudo ln -s ìƒˆë¡­ê²Œ í•œêµ­ ì‹œê°„ëŒ€(KST) ì— ë§ëŠ” íƒ€ì„ì¡´ íŒŒì¼ì„ /etc/localtimeì— ì‹¬ë³¼ë¦­ ë§í¬ë¡œ ì—°ê²°
#      - name: Set timezone to KST
#        run: |  # | ë’¤ì— ì˜¤ëŠ” ì¤„ë“¤ì€ ëª¨ë‘ í•œ ë©ì–´ë¦¬ì˜ ìŠ¤í¬ë¦½íŠ¸ë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤ (ì—¬ëŸ¬ ì¤„ ê°€ëŠ¥)
#          sudo rm /etc/localtime
#          sudo ln -s /usr/share/zoneinfo/Asia/Seoul /etc/localtime
#
#      # ê¹ƒí—ˆë¸Œì—ëŠ” mysqlì´ ì´ë¯¸ ì„¤ì¹˜ ë˜ì–´ ìˆì–´ì„œ ì‹¤í–‰ë§Œ í•˜ë©´ë¨.
#      - name: Start Mysql
#        run: |  # | (íŒŒì´í”„ë¼ì¸) ì€ yaml ë¬¸ë²•ì¸ë°, value ë¥¼ multi-line ìœ¼ë¡œ ì“°ê³  ì‹¶ì„ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.
#          sudo systemctl start mysql
#          mysql -e "use mysql; FLUSH PRIVILEGES; ALTER USER '${{ env.MYSQL_USER }}'@'localhost' IDENTIFIED BY '${{ env.MYSQL_PASSWORD }}';" -uroot -proot
#          mysql -e 'CREATE DATABASE ${{ env.MYSQL_DATABASE }};' -u${{ env.MYSQL_USER }} -p${{ env.MYSQL_PASSWORD }}
#
#      #mysql -e
#      #â†’ MySQL ì»¤ë§¨ë“œë¼ì¸ í´ë¼ì´ì–¸íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©° -e ì˜µì…˜ì€ ì¦‰ì„ì—ì„œ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
#      #
#      #"use mysql; ..."
#      #â†’ ë¨¼ì € ì‹œìŠ¤í…œ DBì¸ mysqlì„ ì‚¬ìš©í•œ í›„, ê¶Œí•œ ê°±ì‹  ë° ì‚¬ìš©ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•©ë‹ˆë‹¤.
#      #
#      #FLUSH PRIVILEGES;
#      #â†’ ê¶Œí•œ ë³€ê²½ ì‚¬í•­ì„ MySQLì— ì¦‰ì‹œ ë°˜ì˜í•©ë‹ˆë‹¤.
#      #
#      #ALTER USER ... IDENTIFIED BY ...
#      #â†’ í™˜ê²½ ë³€ìˆ˜ ${{ env.MYSQL_USER }} ì™€ ${{ env.MYSQL_PASSWORD }}ë¥¼ ì‚¬ìš©í•´
#      #í•´ë‹¹ ì‚¬ìš©ìì— ëŒ€í•´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì¬ì„¤ì •í•©ë‹ˆë‹¤.
#      #(CI í™˜ê²½ì—ì„  ì´ˆê¸° ì‚¬ìš©ì ì„¸íŒ…ì´ í•„ìš”í•˜ê¸° ë•Œë¬¸ì— ì´ ì„¤ì •ì´ ì¤‘ìš”í•©ë‹ˆë‹¤)
#      #
#      #-uroot -proot
#      #â†’ MySQLì˜ root ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•©ë‹ˆë‹¤. ë¹„ë°€ë²ˆí˜¸ëŠ” root.
#
##      - name: Run tests
##        run: |
##          poetry run coverage run -m pytest .
##          poetry run coverage report -m
#
#      # í…ŒìŠ¤íŠ¸ íŒŒì¼ì´ ìˆëŠ” ê²½ìš°ì—ë§Œ ì‹¤í–‰
##      - name: Run tests only if test files exist
##        run: |
##          if find . -type f -name 'test_*.py' | grep -q .; then
##            echo "âœ… Test files found. Running pytest..."
##            poetry run coverage run -m pytest .
##            poetry run coverage report -m
##          else
##            echo "âš ï¸ No test files found. Skipping tests."
##          fi
#
#      # ì‹¤ì œë¡œ í…ŒìŠ¤íŠ¸ í•  ìˆ˜ ìˆëŠ” ì½”ë“œê°€ ìˆëŠ”ì§€ íŒë³„ í›„ í…ŒìŠ¤íŠ¸ ìˆ˜í–‰
#      - name: Run tests only if tests actually exist
#        run: |
#          echo "ğŸ” Checking if pytest can collect any tests..."
#          TEST_COUNT=$(poetry run pytest --collect-only -q 2>/dev/null | grep -c '::' || true)
#
#          if [ "$TEST_COUNT" -gt 0 ]; then
#            echo "âœ… Found $TEST_COUNT tests. Running pytest..."
#            poetry run coverage run -m pytest .
#            poetry run coverage report -m
#          else
#            echo "âš ï¸ No runnable tests found. Skipping pytest."
#          fi
#
#      # pytest --collect-only : í…ŒìŠ¤íŠ¸ ìˆ˜ì§‘
#      # pytest --collect-only -q: í…ŒìŠ¤íŠ¸ ëª©ë¡ë§Œ ì¶œë ¥
#      # grep -c '::': í…ŒìŠ¤íŠ¸ ê°œìˆ˜ ì„¸ê¸°
#      # poetry run pytest ... || true â†’ í…ŒìŠ¤íŠ¸ ì—†ì–´ì„œ ì‹¤íŒ¨í•´ë„ ì •ìƒ ì¢…ë£Œ ì²˜ë¦¬ (ìµœì¢… ì¢…ë£Œ ì½”ë“œëŠ” 0)
#      # grep -c '::'ë¡œ ì‹¤ì œ ìˆ˜ì§‘ ê°€ëŠ¥í•œ í…ŒìŠ¤íŠ¸ ê°œìˆ˜ë¥¼ ì •í™•íˆ íŒë³„
#
#      # í…ŒìŠ¤íŠ¸ê°€ ì—†ëŠ” ê²½ìš° pytestëŠ” ì¢…ë£Œ ì½”ë“œë¥¼ 5ë¡œ ë°˜í™˜í•©ë‹ˆë‹¤ â†’ "ìˆ˜í–‰í•  í…ŒìŠ¤íŠ¸ê°€ ì—†ìŒ"
#      # GitHub ActionsëŠ” 0ì´ ì•„ë‹Œ ëª¨ë“  ì¢…ë£Œ ì½”ë“œë¥¼ ì‹¤íŒ¨ë¡œ ê°„ì£¼
#
#      # pytest ì¢…ë£Œ ì½”ë“œ (exit code)
#      # 0	í…ŒìŠ¤íŠ¸ ì„±ê³µ (ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼)
#      # 1	í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ (ì–´ë–¤ í…ŒìŠ¤íŠ¸ë“  ì‹¤íŒ¨í•¨)
#      # 2	ì‚¬ìš©ë²• ì—ëŸ¬ (ì˜ˆ: ì˜ëª»ëœ ì¸ì)
#      # 3	ë‚´ë¶€ ì—ëŸ¬
#      # 4	pytest í”ŒëŸ¬ê·¸ì¸ ì—ëŸ¬
#      # 5	í…ŒìŠ¤íŠ¸ ì—†ìŒ (no tests collected)